- name: Update apt cache
  apt: update_cache=yes
  # apt: update_cache=yes cache_valid_time=86400
  tags: online

- name: Install apt packages
  apt: name={{ item }} state=present
  with_items:
    - html2text
    - emacs24-nox
    - vim
    - ntp
    - apache2
    - openjdk-8-jre
    # only works on ubuntu
    # - libjstl1.1-java
    - tomcat8
    #- tomcat"{{ tomcat_version }}"-admin
    # - libmysql-java
    - libapache2-mod-shib2
    #~ - shibboleth-sp2-common
    #~ - shibboleth-sp2-utils
    - libapache2-mod-php7.0
  tags: online

- name: Configure /etc/hosts
  template: 
    src: roles/common/templates/hosts 
    dest: /etc/hosts

- name: get JAVA_HOME
  shell: readlink -f /usr/bin/java | sed "s:bin/java::"
  register: java_home

- name: Configure /etc/environment
  template: src=roles/common/templates/environment dest=/etc/environment

- name: Install CA Certificate
  copy: src=roles/common/files/{{ domain }}/cacert.pem dest={{ cert_path }}/cacert.pem

- name: Install CA Key
  copy: src=roles/common/files/{{ domain }}/cakey.pem dest={{ cert_path }}/private mode=0600

- name: Install IdP Certificate
  copy: src=roles/common/files/{{ domain }}/{{ idp_fqdn }}-cert.pem dest={{ cert_path }}/{{ idp_fqdn }}-cert.pem

- name: Install IdP Key
  copy: src=roles/common/files/{{ domain }}/{{ idp_fqdn }}-key.pem dest={{ cert_path }}/private/{{ idp_fqdn }}-key.pem group=ssl-cert mode=0640

- name: Install SP Certificate
  copy: src=roles/common/files/{{ domain }}/{{ sp_fqdn }}-cert.pem dest={{ cert_path }}/{{ sp_fqdn }}-cert.pem

- name: Install SP Key
  copy: src=roles/common/files/{{ domain }}/{{ sp_fqdn }}-key.pem dest={{ cert_path }}/private/{{ sp_fqdn }}-key.pem group=ssl-cert mode=0640
